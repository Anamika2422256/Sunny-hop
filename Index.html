<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SUNNY HOP: STICKMAN ADVENTURE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');
        body { margin: 0; background: #87CEEB; overflow: hidden; font-family: 'Fredoka One', cursive; user-select: none; }
        canvas { display: block; }
        #hud { position: absolute; top: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 30px; box-sizing: border-box; pointer-events: none; z-index: 10; }
        #hearts { display: flex; gap: 5px; pointer-events: auto; }
        .heart { font-size: 35px; color: #ff4757; text-shadow: 2px 2px #fff; }
        #stats { color: #fff; font-size: 24px; text-shadow: 2px 2px #000; text-align: right; }
        #pause-btn { pointer-events: auto; cursor: pointer; font-size: 35px; color: #fff; text-shadow: 2px 2px #000; }
        .screen { position: absolute; inset: 0; background: rgba(255, 255, 255, 0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; backdrop-filter: blur(5px); }
        .title { font-size: 70px; color: #ff4757; margin-bottom: 0; text-shadow: 4px 4px #fff; }
        .subtitle { font-size: 24px; color: #2f3542; margin-bottom: 30px; }
        .btn-group { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .btn { background: #2ed573; border: 4px solid #fff; color: #fff; padding: 15px 60px; cursor: pointer; font-size: 22px; border-radius: 50px; box-shadow: 0 6px #1e9e54; width: 220px; font-family: 'Fredoka One', cursive; }
        .btn:active { transform: translateY(4px); box-shadow: 0 2px #1e9e54; }
        .btn.blue { background: #1e90ff; box-shadow: 0 6px #0984e3; }
        .btn.orange { background: #ffa502; box-shadow: 0 6px #e17055; }
    </style>
</head>
<body>

    <div id="hud">
        <div id="hearts"></div>
        <div id="stats">SCORE: <span id="score-val">0</span><br>üíé <span id="diamond-count">0</span></div>
        <div id="pause-btn" onclick="togglePause()">‚öôÔ∏è</div>
    </div>

    <div id="home-screen" class="screen">
        <div style="font-size: 80px; margin-bottom: 10px;">üèÉüé©</div>
        <h1 class="title">SUNNY HOP</h1>
        <p class="subtitle">A Stickman's Big Adventure</p>
        <button class="btn" onclick="showLevelSelect()">START GAME</button>
    </div>

    <div id="level-screen" class="screen" style="display:none">
        <h2 class="title" style="font-size: 50px;">CHOOSE LEVEL</h2>
        <div class="btn-group" style="flex-direction: row; gap: 20px;">
            <button class="btn" onclick="initGame(1)">EASY</button>
            <button class="btn blue" onclick="initGame(2)">MEDIUM</button>
            <button class="btn orange" onclick="initGame(3)">HARD</button>
        </div>
    </div>

    <div id="menu-screen" class="screen" style="display:none">
        <h2 id="menu-title" class="title" style="font-size: 50px;">PAUSED</h2>
        <div class="btn-group">
            <button class="btn" id="resume-btn" onclick="togglePause()">CONTINUE</button>
            <button class="btn blue" onclick="resetLevel()">RESTART</button>
            <button class="btn orange" onclick="location.reload()">HOME</button>
        </div>
    </div>

    <canvas id="c"></canvas>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        let w, h, player, platforms, items, active = false, paused = false, waiting = true;
        let currentLvl = 1, cameraX = 0, diamonds = 0, lives = 5, score = 0;
        let isSpacePressed = false;

        // PHYSICS TWEAKS
        const GRAVITY = 0.8; 
        const JUMP_FORCE = -18; 
        const HOLD_LIFT = 0.5; // Extra lift when holding space

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(f, t, d) {
            try {
                const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
                o.type = t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
                o.connect(g); g.connect(audioCtx.destination);
                g.gain.setValueAtTime(0.05, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
                o.start(); o.stop(audioCtx.currentTime + d);
            } catch(e) {}
        }

        function showLevelSelect() {
            document.getElementById('home-screen').style.display = 'none';
            document.getElementById('level-screen').style.display = 'flex';
        }

        function initGame(lvl) {
            currentLvl = lvl;
            lives = 5; diamonds = 0; score = 0;
            document.getElementById('diamond-count').innerText = "0";
            document.getElementById('score-val').innerText = "0";
            document.getElementById('level-screen').style.display = 'none';
            document.getElementById('menu-screen').style.display = 'none';
            setupWorld();
            updateHearts();
            waiting = true;
            active = true;
            requestAnimationFrame(gameLoop);
        }

        function setupWorld() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            player = { 
                x: 100, y: h-400, 
                vx: 6 + (currentLvl * 1.5), // Faster horizontal speed
                vy: 0, w: 40, h: 70, 
                grounded: false 
            };
            
            platforms = []; items = [];
            let sx = 0;
            for(let i=0; i<100; i++) {
                let pw = (i === 0) ? 800 : 250 + Math.random() * 400;
                let py = (i === 0) ? h - 200 : h - 150 - (Math.random() * 250);
                platforms.push({ x: sx, y: py, w: pw });
                if(i > 0) {
                    if(Math.random() > 0.4) items.push({ x: sx + pw/2, y: py - 40, type: 'd' });
                    if(Math.random() > 0.94) items.push({ x: sx + pw/2, y: py - 120, type: 'h' });
                }
                sx += pw + (150 + currentLvl * 50); // Gap distance
            }
            cameraX = 0;
        }

        function updateHearts() {
            const con = document.getElementById('hearts');
            con.innerHTML = '';
            for(let i=0; i<5; i++) con.innerHTML += i < lives ? '<span class="heart">‚ù§</span>' : '<span class="heart" style="filter:grayscale(1); opacity:0.2">‚ù§</span>';
        }

        window.addEventListener('keydown', (e) => {
            if(e.code === 'Space') {
                if(!active || paused) return;
                isSpacePressed = true;
                if(waiting) {
                    waiting = false;
                    if(audioCtx.state === 'suspended') audioCtx.resume();
                } else if(player.grounded) {
                    player.vy = JUMP_FORCE;
                    player.grounded = false;
                    playSfx(400, 'sine', 0.1);
                }
            }
        });

        window.addEventListener('keyup', (e) => {
            if(e.code === 'Space') isSpacePressed = false;
        });

        function togglePause() {
            if(!active) return;
            paused = !paused;
            document.getElementById('menu-screen').style.display = paused ? 'flex' : 'none';
        }

        function resetLevel() {
            paused = false;
            initGame(currentLvl);
        }

        function gameLoop() {
            if(!active) return;
            if(!paused) {
                // APPLY GRAVITY
                let currentGravity = GRAVITY;
                // If holding space while moving UP, defy gravity
                if(isSpacePressed && player.vy < 0) {
                    currentGravity -= HOLD_LIFT; 
                }
                player.vy += currentGravity;

                if(!waiting) {
                    player.x += player.vx;
                    score = Math.max(score, Math.floor(player.x / 10));
                    document.getElementById('score-val').innerText = score;
                }
                player.y += player.vy;
                
                player.grounded = false;
                platforms.forEach(p => {
                    // Check if falling onto platform
                    if(player.x+player.w > p.x && player.x < p.x+p.w && 
                       player.y+player.h >= p.y && player.y+player.h <= p.y + player.vy + 12) {
                        player.y = p.y - player.h; 
                        player.vy = 0; 
                        player.grounded = true;
                    }
                });

                if(!waiting) {
                    items.forEach((it, i) => {
                        if(Math.abs(player.x - it.x) < 50 && Math.abs(player.y - it.y) < 70) {
                            if(it.type === 'd') { diamonds += 10; document.getElementById('diamond-count').innerText = diamonds; playSfx(900, 'sine', 0.05); }
                            else { if(lives < 5) lives++; updateHearts(); playSfx(700, 'sine', 0.1); }
                            items.splice(i, 1);
                        }
                    });

                    if(player.y > h) { 
                        lives--; updateHearts(); playSfx(200, 'sawtooth', 0.2);
                        if(lives <= 0) { 
                            active = false; 
                            document.getElementById('menu-screen').style.display = 'flex'; 
                            document.getElementById('menu-title').innerText = "GAME OVER"; 
                            document.getElementById('resume-btn').style.display = 'none'; 
                        } else { 
                            player.x -= 400; player.y = -100; player.vy = 0; 
                            waiting = true; 
                        }
                    }
                    cameraX = player.x - 150;
                }
            }
            draw();
            requestAnimationFrame(gameLoop);
        }

        function draw() {
            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = "white";
            for(let i=0; i<6; i++) {
                let cloudX = (i*500 - (cameraX*0.3)%w + w)%w;
                ctx.beginPath(); ctx.arc(cloudX, 150 + (i%3*30), 40, 0, Math.PI*2); ctx.arc(cloudX+30, 150 + (i%3*30), 30, 0, Math.PI*2); ctx.fill();
            }

            ctx.save(); ctx.translate(-cameraX, 0);
            platforms.forEach(p => {
                ctx.fillStyle = '#74b9ff'; ctx.fillRect(p.x, p.y, p.w, h);
                ctx.strokeStyle = '#fff'; ctx.lineWidth = 4; ctx.strokeRect(p.x, p.y, p.w, h);
            });
            items.forEach(it => {
                ctx.font = "32px Arial"; ctx.textAlign = "center";
                ctx.fillText(it.type === 'd' ? 'üíé' : '‚ù§Ô∏è', it.x, it.y);
            });

            const walk = (waiting || !player.grounded) ? 0 : Math.sin(Date.now()*0.015)*20;
            ctx.strokeStyle = '#2f3542'; ctx.lineWidth = 5; ctx.lineCap = 'round';
            ctx.beginPath(); ctx.arc(player.x+20, player.y+15, 10, 0, Math.PI*2); ctx.stroke();
            ctx.fillStyle = '#2f3542'; ctx.fillRect(player.x+2, player.y-2, 36, 5); ctx.fillRect(player.x+10, player.y-15, 20, 15); 
            ctx.beginPath(); ctx.moveTo(player.x+20, player.y+25); ctx.lineTo(player.x+20, player.y+50);
            ctx.moveTo(player.x+20, player.y+50); ctx.lineTo(player.x+20+walk, player.y+70); 
            ctx.moveTo(player.x+20, player.y+50); ctx.lineTo(player.x+20-walk, player.y+70);
            ctx.moveTo(player.x+20, player.y+35); ctx.lineTo(player.x+35, player.y+45);
            ctx.stroke();
            ctx.restore();

            if(waiting && !paused) {
                ctx.fillStyle = "rgba(0,0,0,0.6)"; ctx.fillRect(0, h/2 - 60, w, 120);
                ctx.fillStyle = "white"; ctx.font = "32px 'Fredoka One'"; ctx.textAlign = "center";
                ctx.fillText("READY? PRESS [ SPACE ]", w/2, h/2 - 5);
                ctx.font = "20px 'Fredoka One'"; ctx.fillText("HOLD SPACE LONGER TO FLY HIGHER", w/2, h/2 + 35);
            }
        }
    </script>
</body>
</html>
